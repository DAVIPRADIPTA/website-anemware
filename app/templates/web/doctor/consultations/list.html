{# templates/web/doctor/consultations/list.html #}
{% extends "web/doctor/_layout.html" %}
{% block title %}Konsultasi{% endblock %}

{% block head_extra %}
<style>
  .wrap-card{
    border-radius:16px;
    border:1px solid var(--border);
    box-shadow:var(--shadow);
    background:var(--surface);
  }
  .table thead th{
    background:#f8fafc;
    border-bottom:1px solid var(--border);
    font-weight:800;
    color:#111827;
    white-space:nowrap;
  }
  .muted{ color:var(--muted); font-size:.9rem; }
  .who{ font-weight:900; margin:0; line-height:1.2; }
  .sub{ color:var(--muted); font-size:.9rem; margin-top:2px; }
  .chip{
    display:inline-flex;
    align-items:center;
    gap:8px;
    padding:6px 10px;
    border-radius:999px;
    border:1px solid var(--border);
    background:#f3f4f6;
    font-weight:800;
    font-size:.85rem;
  }
</style>
{% endblock %}

{% block content %}
  <div class="page-header">
    <div>
      <h2>Konsultasi Pasien</h2>
      <p>Daftar sesi konsultasi yang masuk ke akun Anda.</p>
    </div>
    <div class="d-flex gap-2 flex-wrap">
      <span class="chip"><i class="bi bi-list-check"></i>Total: {{ consultations|length }}</span>
    </div>
  </div>

  {% if not doctor.is_verified %}
    <div class="alert alert-warning panel-card mb-3">
      <div class="d-flex align-items-start gap-2">
        <i class="bi bi-exclamation-triangle fs-5"></i>
        <div>
          <div class="fw-bold">Akun belum terverifikasi.</div>
          <div class="text-muted">
            Fitur konsultasi dikunci sampai STR/SIP diupload.
            <a href="{{ url_for('doctor.verification') }}" class="fw-bold text-decoration-none">Upload verifikasi</a>.
          </div>
        </div>
      </div>
    </div>
  {% endif %}

  <div class="card wrap-card">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-hover align-middle mb-0">
          <thead>
            <tr>
              <th>Pasien</th>
              <th>Mulai</th>
              <th>Status</th>
              <th style="width:140px;">Aksi</th>
            </tr>
          </thead>
          <tbody>
            {% for c in consultations %}
              <tr>
                <td>
                  <p class="who">{{ c.patient.full_name }}</p>
                  <div class="sub"><i class="bi bi-person me-1"></i>ID: #{{ c.patient_id }}</div>
                </td>

                <td class="muted">
                  {{ c.created_at.strftime("%d %b %Y %H:%M") if c.created_at else "-" }}
                </td>

                <td>
                  {% if c.status == "active" %}
                    <span class="badge bg-success"><i class="bi bi-chat-dots me-1"></i>Aktif</span>
                  {% elif c.status == "completed" %}
                    <span class="badge bg-secondary"><i class="bi bi-check2-circle me-1"></i>Selesai</span>
                  {% else %}
                    <span class="badge bg-warning text-dark"><i class="bi bi-hourglass-split me-1"></i>Pending</span>
                  {% endif %}
                </td>

                <td>
                  <a href="{{ url_for('doctor_consult.chat', id=c.id) }}"
                     class="btn btn-success btn-sm {% if not doctor.is_verified %}disabled{% endif %}">
                    <i class="bi bi-box-arrow-in-right me-1"></i>Masuk
                  </a>
                </td>
              </tr>
            {% endfor %}

            {% if consultations|length == 0 %}
              <tr>
                <td colspan="4" class="text-center muted py-4">Belum ada konsultasi.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
