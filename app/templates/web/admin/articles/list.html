{# templates/web/admin/articles/list.html #}
{% extends "web/admin/_layout.html" %}

{% block title %}Manajemen Artikel{% endblock %}

{% block content %}
  <div class="page-header">
    <div>
      <h2>Manajemen Artikel (Upload Dokter)</h2>
      <p>Kelola artikel yang dibuat oleh dokter.</p>
    </div>
  </div>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mb-3">
        {% for category, msg in messages %}
          <div class="alert alert-{{ category }} mb-2">{{ msg }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <div class="card border-0 shadow-sm" style="border-radius: 16px;">
    <div class="card-body">
      <div class="table-responsive">
        <table class="table table-bordered table-striped align-middle mb-0">
          <thead>
            <tr>
              <th>Judul</th>
              <th>Dokter</th>
              <th>Tags</th>
              <th>Gambar</th>
              <th>Dibuat</th>
              <th>Update</th>
              <th style="width: 200px;">Aksi</th>
            </tr>
          </thead>

          <tbody>
            {% for a in articles %}
              <tr>
                <td>
                  <div class="fw-semibold">{{ a.title }}</div>
                  <div class="text-muted small">
                    {{ (a.content[:120] ~ '...') if a.content and a.content|length > 120 else a.content }}
                  </div>
                </td>

                <td>
                  {{ a.author.full_name if a.author and a.author.full_name else (a.author.email if a.author else '-') }}
                </td>

                <td>
                  {% if a.tags %}
                    {% for t in a.tags.split(',') %}
                      <span class="badge bg-secondary">{{ t.strip() }}</span>
                    {% endfor %}
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>

                <td>
                  {% if a.image_url %}
                    <a href="/{{ a.image_url }}" target="_blank" class="btn btn-outline-secondary btn-sm">
                      <i class="bi bi-image me-1"></i> Lihat
                    </a>
                  {% else %}
                    <span class="text-muted">-</span>
                  {% endif %}
                </td>

                <td>{{ a.created_at.strftime("%Y-%m-%d %H:%M") if a.created_at else "-" }}</td>
                <td>{{ a.updated_at.strftime("%Y-%m-%d %H:%M") if a.updated_at else "-" }}</td>

                <td>
                  <a href="{{ url_for('admin_article.edit_article', id=a.id) }}" class="btn btn-warning btn-sm">
                    <i class="bi bi-pencil-square me-1"></i> Edit
                  </a>

                  <form
                    action="{{ url_for('admin_article.delete_article', id=a.id) }}"
                    method="POST"
                    style="display:inline;"
                    onsubmit="return confirm('Hapus artikel ini?');"
                  >
                    <button class="btn btn-danger btn-sm">
                      <i class="bi bi-trash me-1"></i> Hapus
                    </button>
                  </form>
                </td>
              </tr>
            {% endfor %}

            {% if articles|length == 0 %}
              <tr>
                <td colspan="7" class="text-center text-muted">Belum ada artikel.</td>
              </tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
{% endblock %}
